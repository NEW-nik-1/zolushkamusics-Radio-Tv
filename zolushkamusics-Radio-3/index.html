<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DJ Room с радио, ТВ, чат, играми и визуализацией</title>
<style>
  body {
    margin: 0;
    font-family: Inter, system-ui, -apple-system;
    background: #1f1230;
    color: #eee;
  }
  .container { max-width: 1200px; margin: 20px auto; }
  .player-area { display: flex; gap: 12px; margin-bottom: 10px; }
  button {
    cursor: pointer; border: none; background: #84cc16; color: #111;
    padding: 8px 16px; font-size: 14px; border-radius: 6px;
    display: flex; align-items: center; gap: 8px;
  }

  /* Размеры контейнеров ТВ и Игры увеличены */
  #tv-iframe-container, #game-iframe-container {
    position: fixed; left: 20px; top: 80px;
    width: 700px;
    height: 400px;
    background: #000; border: 2px solid #84cc16; border-radius: 12px;
    overflow: hidden; display: none; z-index: 10000; flex-direction: column;
    transition: height 0.2s, width 0.2s;
  }

  /* Размеры чата — задаются здесь */
  #volnorez_chat {
    width: 850px;      /* фиксированная ширина чата */
    height: 550px;     /* фиксированная высота чата */
    overflow-y: auto;  /* вертикальный скролл если наполненность превышает размер */
  }

  #tv-iframe-header, #game-iframe-header {
    background: #222; padding: 6px 12px; display: flex; justify-content: flex-end; gap: 12px; user-select: none;
  }
  #tv-iframe-header button, #game-iframe-header button {
    background: none; border: none; color: #eee; font-size: 20px; cursor: pointer;
    width: 24px; height: 24px; line-height: 24px; text-align: center; padding: 0;
  }
  #tv-iframe, #game-iframe {
    width: 100%;
    height: 100%;
    border: none;
    display: block;
    background: #000;
  }

  .main { display: flex; gap: 20px; }
  .left-col { width: 220px; background: #2b1f47; padding: 16px; border-radius: 12px; display: flex; flex-direction: column; gap: 15px; }
  .art { width: 120px; height: 80px; background: #111; border-radius: 8px; overflow: hidden; margin-bottom: 8px; }
  .title { font-weight: 700; font-size: 16px; margin-bottom: 4px; }
  .sub { font-size: 13px; color: #bdbdbd; margin-bottom: 12px; }
  .games-header { border: none; background: #84cc16; color: #111; padding: 8px; border-radius: 6px; font-weight: 600; cursor: pointer; }
  .games-list { background: #222; border-radius: 8px; padding: 12px; max-height: 280px; overflow-y: auto; display: none; }
  .games-list ul { list-style: none; margin: 0; padding: 0; }
  .games-list ul li a { color: #84cc16; text-decoration: none; display: block; padding: 4px 0; cursor: pointer; }

  .right-col { flex: 1; background: #1b1136; border-radius: 12px; padding: 12px; height: 900px; position: relative; } /* Высота родителя увеличена для чата */
  .game-tooltip-wrapper-corner {
    position: absolute; top: 5px; left: 5px; z-index: 10002;
  }
  .game-tooltip-wrapper-corner .game-tooltip-icon {
    cursor: pointer; background: #84cc16; color: #111; font-weight: bold;
    border-radius: 50%; width: 24px; height: 24px; display: flex;
    align-items: center; justify-content: center; font-size: 16px;
  }
  .game-tooltip-wrapper-corner .game-tooltip-text {
    visibility: hidden; width: 220px; background-color: #222; color: #eee;
    text-align: center; border-radius: 6px; padding: 6px; position: absolute;
    z-index: 10001; top: 30px; left: 0; opacity: 0; transition: opacity 0.3s;
  }
  .game-tooltip-wrapper-corner:hover .game-tooltip-text {
    visibility: visible; opacity: 1;
  }
</style>
</head>
<body>
<div class="container">

  <div class="player-area">
    <button id="playBtn" title="Радио">▶ Включить радио</button>
    <button id="playTvBtn" title="ТВ">Включить ТВ</button>
  </div>

  <section id="tv-iframe-container">
    <div id="tv-iframe-header">
      <button id="tvMinimizeBtn">–</button>
      <button id="tvRestoreBtn" style="display:none;">□</button>
      <button id="tvCloseBtn">×</button>
    </div>
    <iframe id="tv-iframe" src="about:blank" allowfullscreen></iframe>
  </section>

  <section id="game-iframe-container">
    <div id="game-iframe-header">
      <button id="gameMinimizeBtn">–</button>
      <button id="gameRestoreBtn" style="display:none;">□</button>
      <button id="gameCloseBtn">×</button>
    </div>
    <div class="game-tooltip-wrapper-corner">
      <span class="game-tooltip-icon">?</span>
      <div class="game-tooltip-text">Звук игры можно отключить в настройках игры.</div>
    </div>
    <iframe id="game-iframe" src="about:blank" allowfullscreen></iframe>
  </section>

  <div class="main">
    <div class="left-col">
      <div class="art"><canvas id="artSpectrum" width="120" height="80"></canvas></div>
      <div class="title">Volnorez Radio</div>
      <div class="sub">Live stream</div>
      <button class="games-header">СПИСОК ИГР</button>
      <div class="games-list">
        <ul id="gamesListContainer"></ul>
      </div>
    </div>
    <div class="right-col">
      <div id="volnorez_chat" data-code="001f69a7" data-skin="skin_4" data-skin-params="'panel_clr':'213,213,213','msgbg_clr':'243,243,243'">
        <script async type="text/javascript" src="//volnorez.com/plugins/jscode/chat_js"></script>
      </div>
    </div>
  </div>
</div>

<audio id="audio" src="https://stream.volnorez.com/live-app/908925" crossorigin="anonymous"></audio>

<script>
const playBtn = document.getElementById('playBtn');
const playTvBtn = document.getElementById('playTvBtn');
const audio = document.getElementById('audio');

const tvIframeContainer = document.getElementById('tv-iframe-container');
const tvIframe = document.getElementById('tv-iframe');
const tvCloseBtn = document.getElementById('tvCloseBtn');
const tvMinimizeBtn = document.getElementById('tvMinimizeBtn');
const tvRestoreBtn = document.getElementById('tvRestoreBtn');

const gameIframeContainer = document.getElementById('game-iframe-container');
const gameIframe = document.getElementById('game-iframe');
const gameCloseBtn = document.getElementById('gameCloseBtn');
const gameMinimizeBtn = document.getElementById('gameMinimizeBtn');
const gameRestoreBtn = document.getElementById('gameRestoreBtn');

const gamesHeaderBtn = document.querySelector('.games-header');
const gamesList = document.querySelector('.games-list');
const gamesListContainer = document.getElementById('gamesListContainer');

let audioCtx, analyser, source, freqData;
let artCtx, artCanvas, artAnalyser, artFreqData;

const games = [
  { name: "Gary's World", url: "https://html5.gamemonetize.co/dd5rs8etri5hw51g32sk69qfdoov5tq2/" },
  { name: "Crazy Ball Adventures", url: "https://www.onlinegames.io/games/2021/unity2/crazy-ball-adventures/index.html" },
  { name: "Subway Horror Chapter 1", url: "https://www.gamenora.com/embed/subway-horror-chapter-1" },
  { name: "A Difficult Game About Climbing", url: "https://www.gamenora.com/embed/a-difficult-game-about-climbing" },
  { name: "Cross The Road", url: "https://www.onlinegames.io/games/2023/unity/cross-the-road/index.html" },
  { name: "Motorcycle Racer", url: "https://s3.eponesh.com/games/8866/" },
  { name: "Moto Rider GO", url: "https://app-165758.games.s3.yandex.net/165758/ghtg4xyuxt09og6gtji0jcl6aw8el4w4/index.html" },
  { name: "Motorbike Traffic", url: "https://www.onlinegames.io/games/2021/unity/motorbike-traffic/index.html" },
  { name: "Turbo Moto Racer 3D", url: "https://www.gamenora.com/splash/turbo-moto-racer-3d/" },
  { name: "ATV Highway Traffic", url: "https://www.onlinegames.io/games/2021/unity/atv-highway-traffic/index.html" },
  { name: "Traffic Tour", url: "https://traffictour.github.io/traffic-tour/" }
];

// динамическое создание списка игр
games.forEach(game => {
  const li = document.createElement('li');
  const a = document.createElement('a');
  a.href = "#";
  a.textContent = game.name;
  a.dataset.url = game.url;
  li.appendChild(a);
  gamesListContainer.appendChild(li);
});

function initAudio() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    source = audioCtx.createMediaElementSource(audio);
    source.connect(analyser);
    analyser.connect(audioCtx.destination);
    analyser.fftSize = 1024;
    freqData = new Uint8Array(analyser.frequencyBinCount);
  }
  if (!artCtx) {
    artCanvas = document.getElementById('artSpectrum');
    artCtx = artCanvas.getContext('2d');
    artAnalyser = analyser;
    artFreqData = freqData;
  }
}
function drawArtSpectrum() {
  requestAnimationFrame(drawArtSpectrum);
  if (!artAnalyser) return;
  artAnalyser.getByteFrequencyData(artFreqData);
  const w = artCanvas.width, h = artCanvas.height;
  artCtx.clearRect(0, 0, w, h);
  const count = artFreqData.length / 4;
  const barWidth = w / count;
  for (let i = 0; i < count; i++) {
    const val = artFreqData[i];
    const barHeight = val * (h / 256);
    const x = i * barWidth;
    const y = h - barHeight;
    const gradient = artCtx.createLinearGradient(0, y, 0, y + barHeight);
    gradient.addColorStop(0, '#f59e0b');
    gradient.addColorStop(1, '#84cc16');
    artCtx.fillStyle = gradient;
    artCtx.fillRect(x, y, barWidth - 1, barHeight);
  }
}

playBtn.addEventListener('click', () => {
  initAudio();
  tvIframeContainer.style.display = 'none';
  tvIframe.src = 'about:blank';
  if (audio.paused) {
    audio.play();
    playBtn.textContent = '⏸ Пауза радио';
    drawArtSpectrum();
  } else {
    audio.pause();
    playBtn.textContent = '▶ Включить радио';
  }
});

playTvBtn.addEventListener('click', () => {
  if (!audio.paused) {
    audio.pause();
    playBtn.textContent = '▶ Включить радио';
  }
  gameIframeContainer.style.display = 'none';
  gameIframe.src = 'about:blank';
  if (tvIframeContainer.style.display === 'flex') {
    tvIframeContainer.style.display = 'none';
    tvIframe.src = 'about:blank';
  } else {
    tvIframeContainer.style.display = 'flex';
    tvIframeContainer.style.height = '400px';
    tvIframeContainer.style.width = '700px';
    tvIframe.src = 'https://smotret.tv/';
  }
});

tvCloseBtn.onclick = () => {
  tvIframeContainer.style.display = 'none';
  tvIframe.src = 'about:blank';
}
tvMinimizeBtn.onclick = () => {
  tvIframeContainer.style.height = '40px';
  tvIframeContainer.style.width = '700px';
  tvMinimizeBtn.style.display = 'none';
  tvRestoreBtn.style.display = 'inline-block';
}
tvRestoreBtn.onclick = () => {
  tvIframeContainer.style.height = '400px';
  tvIframeContainer.style.width = '700px';
  tvRestoreBtn.style.display = 'none';
  tvMinimizeBtn.style.display = 'inline-block';
}

gameCloseBtn.onclick = () => {
  gameIframeContainer.style.display = 'none';
  gameIframe.src = 'about:blank';
}
gameMinimizeBtn.onclick = () => {
  gameIframeContainer.style.height = '40px';
  gameIframeContainer.style.width = '700px';
  gameMinimizeBtn.style.display = 'none';
  gameRestoreBtn.style.display = 'inline-block';
}
gameRestoreBtn.onclick = () => {
  gameIframeContainer.style.height = '400px';
  gameIframeContainer.style.width = '700px';
  gameRestoreBtn.style.display = 'none';
  gameMinimizeBtn.style.display = 'inline-block';
}

gamesHeaderBtn.onclick = () => {
  gamesList.style.display = (gamesList.style.display === 'block') ? 'none' : 'block';
};

gamesListContainer.addEventListener('click', e => {
  if (e.target.tagName === 'A') {
    e.preventDefault();
    tvIframeContainer.style.display = 'none';
    tvIframe.src = 'about:blank';
    gameIframeContainer.style.display = 'flex';
    gameIframeContainer.style.height = '400px';
    gameIframeContainer.style.width = '700px';
    gameIframe.src = e.target.dataset.url;
    gamesList.style.display = 'none';
  }
});
</script>
</body>
</html>
